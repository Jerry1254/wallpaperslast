(()=>{var e={};e.id=5363,e.ids=[5363],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},41790:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page-experimental.runtime.prod.js")},35694:(e,a,t)=>{"use strict";t.r(a),t.d(a,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>p,pages:()=>d,routeModule:()=>h,tree:()=>c});var s=t(67096),r=t(16132),l=t(37284),i=t.n(l),n=t(32564),o={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>n[e]);t.d(a,o);let c=["",{children:["mobile",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,26418)),"/Users/kele/Desktop/aicode/wallpaper-admin-last/app/mobile/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,35345)),"/Users/kele/Desktop/aicode/wallpaper-admin-last/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,9291,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/kele/Desktop/aicode/wallpaper-admin-last/app/mobile/page.tsx"],p="/mobile/page",u={require:t,loadChunk:()=>Promise.resolve()},h=new s.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/mobile/page",pathname:"/mobile",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},324:(e,a,t)=>{Promise.resolve().then(t.bind(t,21971))},21971:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>MobilePage});var s=t(30784),r=t(9885),l=t(52451),i=t.n(l),n=t(66386),o=t(95555),c=t(12025),d=t(99098),p=t(57114),u=t(24874);function MobileWallpaperList(){let[e,a]=(0,r.useState)([]),[t,l]=(0,r.useState)(1),[h,m]=(0,r.useState)(0),[x,g]=(0,r.useState)(!0),[v,f]=(0,r.useState)(!0),[w,j]=(0,r.useState)([]),[S,y]=(0,r.useState)(!1),[b,_]=(0,r.useState)(0),P=(0,p.useSearchParams)(),k=P.get("search"),N=P.get("shopId"),fetchWallpapers=async e=>{try{g(!0);let t=new URLSearchParams;k&&t.append("search",k),N&&t.append("shopId",N),t.append("page",String(e)),t.append("pageSize",String(20));let s=await fetch(`/api/wallpapers?${t.toString()}`),r=await s.json();if(s.ok)1===e?a(r.data.list):a(e=>[...e,...r.data.list]),m(r.data.pagination.total),f(r.data.pagination.current*r.data.pagination.pageSize<r.data.pagination.total);else throw Error(r.error||r.details||"获取壁纸列表失败")}catch(e){(0,c.Am)({variant:"destructive",description:e instanceof Error?e.message:"获取壁纸列表失败"})}finally{g(!1)}},E=(0,r.useCallback)(async e=>{try{let a=await fetch("/api/settings"),t=await a.json(),s=t.data?.share_button_text||"点击下载",r=`${window.location.origin}/share/${e.id}`,l=`${s} ${r}`;await navigator.clipboard.writeText(l),(0,c.Am)({description:"分享链接已复制到剪贴板"})}catch(e){(0,c.Am)({variant:"destructive",description:"复制分享链接失败"})}},[]),loadMore=()=>{!x&&v&&l(e=>e+1)};return(0,r.useEffect)(()=>{l(1),fetchWallpapers(1)},[k,N]),(0,r.useEffect)(()=>{t>1&&fetchWallpapers(t)},[t]),(0,r.useEffect)(()=>{let handleScroll=()=>{window.innerHeight+window.scrollY>=document.documentElement.scrollHeight-100&&!x&&v&&loadMore()};return window.addEventListener("scroll",handleScroll),()=>window.removeEventListener("scroll",handleScroll)},[x,v]),(0,s.jsxs)("div",{className:"space-y-4",children:[s.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.map(e=>{let a=e.files[0],t=a.type.startsWith("video/");return(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[s.jsx("div",{className:"relative aspect-[9/16] cursor-pointer",onClick:()=>{j(e.files.map(e=>({url:e.url,type:e.type}))),_(0),y(!0)},children:t?s.jsx(d.F,{src:a.url,className:"w-full h-full object-cover"}):s.jsx(i(),{src:a.url,alt:e.name,fill:!0,className:"object-cover"})}),(0,s.jsxs)("div",{className:"p-3 space-y-2",children:[s.jsx("div",{className:"text-sm font-medium truncate",children:e.name}),s.jsx("div",{className:"text-xs text-gray-500 truncate",children:e.shop_name}),(0,s.jsxs)(o.z,{variant:"outline",size:"sm",className:"w-full",onClick:()=>E(e),children:[s.jsx(n.Z,{className:"h-4 w-4 mr-2"}),"分享"]})]})]},e.id)})}),x&&s.jsx("div",{className:"text-center py-4 text-gray-500",children:"加载中..."}),!x&&!v&&e.length>0&&s.jsx("div",{className:"text-center py-4 text-gray-500",children:"没有更多了"}),!x&&0===e.length&&s.jsx("div",{className:"text-center py-4 text-gray-500",children:"暂无数据"}),s.jsx(u.e,{images:w,initialIndex:b,open:S,onOpenChange:y})]})}var h=t(33770),m=t(14723);function MobilePage(){let e=(0,p.useRouter)(),a=(0,p.useSearchParams)(),[t,l]=(0,r.useState)(a.get("search")||""),[i,n]=(0,r.useState)(a.get("shopId")||"all"),[o,c]=(0,r.useState)([]);(0,r.useEffect)(()=>{let fetchShops=async()=>{try{let e=await fetch("/api/shops"),a=await e.json();a?.data&&c(a.data)}catch(e){console.error("Failed to fetch shops:",e)}};fetchShops()},[]);let handleSearch=t=>{l(t);let s=new URLSearchParams(a.toString());t?s.set("search",t):s.delete("search"),e.push(`/mobile?${s.toString()}`)};return s.jsx("div",{className:"container max-w-[600px] mx-auto p-4 space-y-4",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-4",children:[s.jsx(h.I,{type:"search",placeholder:"搜索壁纸...",value:t,onChange:e=>handleSearch(e.target.value),className:"w-full"}),(0,s.jsxs)(m.Ph,{value:i,onValueChange:t=>{n(t);let s=new URLSearchParams(a.toString());t&&"all"!==t?s.set("shopId",t):s.delete("shopId"),e.push(`/mobile?${s.toString()}`)},children:[s.jsx(m.i4,{children:s.jsx(m.ki,{placeholder:"选择店铺"})}),(0,s.jsxs)(m.Bw,{children:[s.jsx(m.Ql,{value:"all",children:"全部店铺"}),o.map(e=>s.jsx(m.Ql,{value:e.id,children:e.name},e.id))]})]})]}),s.jsx(r.Suspense,{fallback:s.jsx("div",{children:"加载中..."}),children:s.jsx(MobileWallpaperList,{})})]})})}},26418:(e,a,t)=>{"use strict";t.r(a),t.d(a,{$$typeof:()=>i,__esModule:()=>l,default:()=>o});var s=t(95153);let r=(0,s.createProxy)(String.raw`/Users/kele/Desktop/aicode/wallpaper-admin-last/app/mobile/page.tsx`),{__esModule:l,$$typeof:i}=r,n=r.default,o=n}};var a=require("../../webpack-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),t=a.X(0,[6214,6426,3979,968,3157,2451,9071,4894,1327,4333,5555,2025,516,9098,6842,4874],()=>__webpack_exec__(35694));module.exports=t})();