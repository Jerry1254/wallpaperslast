(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[788],{69894:function(e,a,s){Promise.resolve().then(s.bind(s,67879))},67879:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return WallpapersPage}});var t=s(26705),l=s(20955),r=s(56731),n=s(45367),i=s(16691),c=s.n(i),o=s(23611),d=s(66005),h=s(71271),u=s(98965),p=s(69710),m=s(62031),f=s(35831),x=s(61465),j=s(83616),g=s(23177),v=s(81628);let y=l.forwardRef((e,a)=>{let{className:s,value:l,...r}=e;return(0,t.jsx)(g.fC,{ref:a,className:(0,v.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...r,children:(0,t.jsx)(g.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(l||0),"%)")}})})});y.displayName=g.fC.displayName;var w=s(31541);function FileUploader(e){let{onUpload:a,maxSize:s=100,accept:r}=e,[n,i]=(0,l.useState)({}),createThumbnail=async e=>e.type.startsWith("video/")?new Promise(a=>{let s=document.createElement("video");s.preload="metadata",s.src=URL.createObjectURL(e),s.currentTime=1,s.onloadeddata=()=>{let e=document.createElement("canvas");e.width=s.videoWidth,e.height=s.videoHeight;let t=e.getContext("2d");null==t||t.drawImage(s,0,0,e.width,e.height);let l=e.toDataURL("image/jpeg");URL.revokeObjectURL(s.src),a(l)},s.onerror=()=>{URL.revokeObjectURL(s.src),a("")}}):"",uploadFile=async e=>{let s=Math.random().toString(36).substring(7);console.log("Starting upload for file:",{id:s,name:e.name,type:e.type,size:e.size}),i(a=>({...a,[s]:{id:s,name:e.name,progress:0,status:"uploading"}}));try{console.log("Creating thumbnail for:",e.name);let t="";e.type.startsWith("video/")&&(t=await createThumbnail(e)),console.log("Thumbnail created:",t?"success":"not needed");let l=new FormData;l.append("file",e),console.log("FormData created with file"),console.log("Sending upload request");let r=await fetch("/api/upload",{method:"POST",body:l});console.log("Upload response status:",r.status);let n=await r.json();if(console.log("Upload response data:",n),!r.ok)throw Error(n.error||"上传失败");let{url:c}=n;console.log("File uploaded successfully:",c),i(e=>({...e,[s]:{...e[s],progress:100,status:"success"}}));let o={id:s,name:e.name,url:c,type:e.type,...t&&{thumbnail:t}};console.log("Sending file data to parent:",o),a(o),setTimeout(()=>{i(e=>{let{[s]:a,...t}=e;return t})},1e3)}catch(a){console.error("Upload error for file:",e.name,a),i(e=>({...e,[s]:{...e[s],status:"error",error:a.message||"上传失败"}})),(0,h.Am)({variant:"destructive",description:"上传失败: ".concat(a.message||"未知错误")})}},c=(0,l.useCallback)(async(e,a)=>{for(let t of(a.forEach(e=>{let{file:a,errors:t}=e,l=t.map(e=>"file-too-large"===e.code?"文件大小超过 ".concat(s,"MB"):"file-invalid-type"===e.code?"不支持的文件类型":e.message);(0,h.Am)({variant:"destructive",description:"".concat(a.name,": ").concat(l.join(", "))})}),e))await uploadFile(t)},[s,a]),{getRootProps:d,getInputProps:u,isDragActive:p}=(0,j.uI)({onDrop:c,maxSize:1048576*s,accept:r});return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{...d(),className:"\n          border-2 border-dashed rounded-lg p-6\n          flex flex-col items-center justify-center\n          cursor-pointer\n          transition-colors\n          ".concat(p?"border-primary bg-primary/10":"border-border","\n        "),children:[(0,t.jsx)("input",{...u()}),(0,t.jsx)(w.Z,{className:"w-10 h-10 mb-2 text-muted-foreground"}),(0,t.jsxs)("div",{className:"text-center space-y-1",children:[(0,t.jsxs)("p",{className:"text-sm",children:["拖拽文件到此处，或",(0,t.jsx)(o.z,{type:"button",variant:"link",className:"px-1",children:"点击上传"})]}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["支持的文件类型：图片 (PNG, JPG, GIF) 和视频 (MP4, WebM)",(0,t.jsx)("br",{}),"单个文件最大 ",s,"MB"]})]})]}),Object.values(n).length>0&&(0,t.jsx)("div",{className:"space-y-2",children:Object.values(n).map(e=>(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{className:"truncate flex-1",children:e.name}),(0,t.jsxs)("span",{className:"ml-2",children:["uploading"===e.status&&"".concat(e.progress,"%"),"error"===e.status&&"上传失败","success"===e.status&&"上传完成"]})]}),"uploading"===e.status&&(0,t.jsx)(y,{value:e.progress,className:"h-1"}),e.error&&(0,t.jsx)("p",{className:"text-xs text-red-500",children:e.error})]},e.id))})]})}var N=s(7532);function AddShopModal(e){let{open:a,onOpenChange:s,onSuccess:r}=e,[n,i]=(0,l.useState)(!1),[c,d]=(0,l.useState)(""),[u,p]=(0,l.useState)(""),handleSubmit=async e=>{if(e.preventDefault(),p(""),!c.trim()){p("店铺名称不能为空");return}i(!0);try{let e=await fetch("/api/shops",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:c.trim()})}),a=await e.json();if(!e.ok)throw Error(a.error||"创建店铺失败");(0,h.Am)({description:"店铺创建成功！"}),s(!1),null==r||r(),d("")}catch(e){p(e.message||"创建店铺失败，请重试")}finally{i(!1)}};return(0,t.jsx)(m.Vq,{open:a,onOpenChange:s,children:(0,t.jsxs)(m.cZ,{className:"sm:max-w-[425px]",children:[(0,t.jsx)(m.fK,{children:(0,t.jsx)(m.$N,{children:"新增店铺"})}),(0,t.jsxs)("form",{onSubmit:handleSubmit,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(x._,{htmlFor:"name",children:"店铺名称"}),(0,t.jsx)(f.I,{id:"name",value:c,onChange:e=>d(e.target.value),placeholder:"请输入店铺名称"}),u&&(0,t.jsx)("p",{className:"text-sm text-red-500",children:u})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,t.jsx)(o.z,{variant:"outline",type:"button",onClick:()=>s(!1),children:"取消"}),(0,t.jsx)(o.z,{type:"submit",disabled:n,children:n?"创建中...":"确定"})]})]})]})})}var b=s(17123),S=s(29743),C=s.n(S),k=s(62601);function UploadWallpaperModal(e){let{open:a,onOpenChange:s,initialData:r,mode:i="create",onSuccess:c}=e,[d,u]=(0,l.useState)([]),[p,j]=(0,l.useState)(""),[g,v]=(0,l.useState)(""),[y,w]=(0,l.useState)([]),[S,E]=(0,l.useState)(!1),[z,A]=(0,l.useState)({}),[P,F]=(0,l.useState)(null),[O,U]=(0,l.useState)(!1);(0,l.useEffect)(()=>{a&&(fetchShops(),"edit"===i&&r?(j(r.name),v(r.shopId),u(r.files.map(e=>({...e,name:e.name||e.url.split("/").pop()||"未命名文件"})))):(j(""),v(""),u([]),A({})))},[a,i,r]);let fetchShops=async()=>{try{let e=await fetch("/api/shops");if(!e.ok)throw Error("Failed to fetch shops");let a=await e.json();if(0===a.code)w(a.data);else throw Error(a.message||"Failed to fetch shops")}catch(e){console.error("Fetch shops error:",e),(0,h.Am)({variant:"destructive",description:"获取店铺列表失败"})}},validateForm=()=>{let e={},a=!0;return p.trim()||(e.name="请输入壁纸名称",a=!1),g||(e.shopId="请选择店铺",a=!1),0===d.length&&(e.files="请上传至少一个文件",a=!1),A(e),a},handleUpload=async()=>{if(validateForm()){U(!0);try{let e="edit"===i&&(null==r?void 0:r.id)?"/api/wallpapers/".concat(r.id):"/api/wallpapers",a="edit"===i?"PUT":"POST",t=await fetch(e,{method:a,headers:{"Content-Type":"application/json"},body:JSON.stringify({name:p,shopId:g,files:d.map(e=>({url:e.url,type:e.type,name:e.name,thumbnail:e.thumbnail}))})}),l=await t.json();if(!t.ok)throw Error(l.error||"操作失败");(0,h.Am)({description:"create"===i?"上传成功！":"更新成功！"}),s(!1),u([]),j(""),v(""),A({}),null==c||c()}catch(e){console.error("Upload error:",e),(0,h.Am)({variant:"destructive",description:e.message||"操作失败，请重试"})}finally{U(!1)}}},handleFileDelete=async e=>{let a=d.find(a=>a.id===e);if(a)try{let s=a.url.startsWith("/")?a.url.slice(1):a.url;C().join(k.cwd(),"public",s),await fetch("/api/upload/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:s})}),u(d.filter(a=>a.id!==e)),P===e&&F(null),d.length<=1&&A(e=>({...e,files:"请上传至少一个文件"}))}catch(e){console.error("Delete file error:",e),(0,h.Am)({variant:"destructive",description:"删除文件失败"})}},L=(0,l.useCallback)(()=>{fetchShops()},[]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.Vq,{open:a,onOpenChange:s,children:(0,t.jsxs)(m.cZ,{className:"max-w-3xl max-h-[85vh] overflow-hidden flex flex-col",children:[(0,t.jsx)(m.fK,{children:(0,t.jsx)(m.$N,{children:"create"===i?"新增壁纸":"编辑壁纸"})}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto px-6",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(x._,{htmlFor:"name",children:"壁纸名称"}),(0,t.jsx)(f.I,{id:"name",value:p,onChange:e=>{j(e.target.value),e.target.value.trim()&&A(e=>({...e,name:void 0}))},placeholder:"请输入壁纸名称"}),z.name&&(0,t.jsx)("p",{className:"text-sm text-red-500",children:z.name})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(x._,{children:"选择店铺"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(N.Ph,{value:g,onValueChange:e=>{v(e),A(e=>({...e,shopId:void 0}))},children:[(0,t.jsx)(N.i4,{className:"flex-1",children:(0,t.jsx)(N.ki,{placeholder:"请选择店铺"})}),(0,t.jsx)(N.Bw,{children:y.map(e=>(0,t.jsx)(N.Ql,{value:e.id,children:e.name},e.id))})]}),(0,t.jsx)(AddShopModal,{open:S,onOpenChange:E,onSuccess:L}),(0,t.jsx)(o.z,{variant:"outline",onClick:()=>E(!0),children:"新增店铺"})]}),z.shopId&&(0,t.jsx)("p",{className:"text-sm text-red-500",children:z.shopId})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(x._,{children:"上传文件"}),(0,t.jsx)(FileUploader,{onUpload:e=>{e.type.startsWith("video/");let a=e.name||e.url.split("/").pop()||"未命名文件";u(s=>[...s,{...e,name:a,thumbnail:e.url}]),A(e=>({...e,files:void 0}))},maxSize:100,accept:{"image/*":[".png",".jpg",".jpeg",".gif"],"video/*":[".mp4",".webm"]}}),z.files&&(0,t.jsx)("p",{className:"text-sm text-red-500",children:z.files})]}),(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:d.map(e=>(0,t.jsxs)("div",{className:"relative group",children:[e.type.startsWith("video/")?(0,t.jsx)("div",{className:"relative aspect-[9/16] bg-gray-100 rounded-lg overflow-hidden group",children:(0,t.jsx)(b.F,{src:e.url,className:"w-full h-full object-cover",onPlay:()=>F(e.id)})}):(0,t.jsx)("div",{className:"relative aspect-[9/16] bg-gray-100 rounded-lg overflow-hidden",children:(0,t.jsx)("img",{src:e.url,alt:e.name,className:"w-full h-full object-cover"})}),(0,t.jsxs)("div",{className:"mt-1 flex items-center justify-between",children:[(0,t.jsx)("p",{className:"text-sm truncate flex-1",children:e.name}),(0,t.jsx)(o.z,{variant:"ghost",size:"icon",className:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>handleFileDelete(e.id),children:(0,t.jsx)(n.Z,{className:"h-4 w-4"})})]})]},e.id))})]})}),(0,t.jsxs)("div",{className:"flex justify-end space-x-2 py-4 px-6 border-t mt-4",children:[(0,t.jsx)(o.z,{variant:"outline",onClick:()=>s(!1),disabled:O,children:"取消"}),(0,t.jsx)(o.z,{onClick:handleUpload,disabled:O,loading:O,children:"create"===i?"上传":"更新"})]})]})}),(0,t.jsx)(AddShopModal,{open:S,onOpenChange:E,onSuccess:L})]})}var E=s(29764),z=s(53589),A=s(35817),P=s(81291),F=s(17158),O=s(17410);function WallpaperList(e){let{searchQuery:a,shopId:s}=e,[r,i]=(0,l.useState)([]),[m,f]=(0,l.useState)(1),[x,j]=(0,l.useState)(0),[g,v]=(0,l.useState)(!1),[y,w]=(0,l.useState)(null),[N,S]=(0,l.useState)(!1),[C,k]=(0,l.useState)(null),[U,L]=(0,l.useState)(!0),[I,T]=(0,l.useState)([]),[W,D]=(0,l.useState)(!1),[R,M]=(0,l.useState)(0),Z=Math.ceil(x/20),fetchWallpapers=async()=>{try{let e;L(!0);let t=new URLSearchParams;a&&t.append("search",a),s&&t.append("shopId",String(s)),t.append("page",String(m)),t.append("pageSize",String(20));let l="/api/wallpapers?".concat(t.toString());console.log("Fetching URL:",l);let r=await fetch(l);console.log("Response status:",r.status),console.log("Response headers:",Object.fromEntries(r.headers.entries()));let n=await r.text();console.log("Raw response:",n);try{e=JSON.parse(n),console.log("Parsed response:",e)}catch(e){throw console.error("Failed to parse response as JSON:",e),Error("API 响应格式错误")}if(r.ok){if(!Array.isArray(e.data.list))throw console.error("Unexpected API response format:",e),Error("API 返回数据格式错误");i(e.data.list),j(e.data.pagination.total)}else throw console.error("API Error:",{status:r.status,statusText:r.statusText,data:e}),Error(e.error||e.details||"获取壁纸列表失败")}catch(e){console.error("Fetch wallpapers error:",e),e instanceof Error&&console.error("Full error details:",{name:e.name,message:e.message,stack:e.stack,cause:e.cause}),(0,h.Am)({variant:"destructive",description:e instanceof Error?e.message:"获取壁纸列表失败"}),i([])}finally{L(!1)}},handleDelete=async()=>{if(y)try{let e=await fetch("/api/wallpapers/".concat(y),{method:"DELETE"});if(e.ok)(0,h.Am)({description:"壁纸已删除"}),f(1),await fetchWallpapers();else{let a=await e.json();(0,h.Am)({variant:"destructive",description:a.error||"删除失败"})}}catch(e){console.error("Delete error:",e),(0,h.Am)({variant:"destructive",description:"删除失败"})}finally{v(!1),w(null)}},handleEdit=e=>{k(e),S(!0)},_=(0,l.useCallback)(async e=>{try{var a;let s=await fetch("/api/settings"),t=await s.json(),l=(null===(a=t.data)||void 0===a?void 0:a.share_button_text)||"点击下载",r="".concat(window.location.origin,"/share/").concat(e.id),n="".concat(l," ").concat(r);await navigator.clipboard.writeText(n),(0,h.Am)({description:"分享链接已复制到剪贴板"})}catch(e){(0,h.Am)({variant:"destructive",description:"复制分享链接失败"})}},[h.Am]),handlePageChange=e=>{f(e)};return(0,l.useEffect)(()=>{f(1),fetchWallpapers()},[a,s]),(0,l.useEffect)(()=>{fetchWallpapers()},[m]),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"rounded-md border",children:(0,t.jsxs)(d.iA,{children:[(0,t.jsx)(d.xD,{children:(0,t.jsxs)(d.SC,{children:[(0,t.jsx)(d.ss,{children:"缩略图"}),(0,t.jsx)(d.ss,{children:"名称"}),(0,t.jsx)(d.ss,{children:"店铺"}),(0,t.jsx)(d.ss,{children:"图片数量"}),(0,t.jsx)(d.ss,{children:"创建时间"}),(0,t.jsx)(d.ss,{className:"text-right",children:"操作"})]})}),(0,t.jsx)(d.RM,{children:r.map(e=>{let a=e.files[0],s=a.type.startsWith("video/");return(0,t.jsxs)(d.SC,{children:[(0,t.jsx)(d.pj,{children:(0,t.jsx)("div",{className:"relative h-[200px] w-[112.5px] cursor-pointer",onClick:()=>{T(e.files.map(e=>({url:e.url,type:e.type}))),M(0),D(!0)},children:s?(0,t.jsx)(b.F,{src:a.url,className:"w-full h-full object-cover rounded-lg"}):(0,t.jsx)(c(),{src:a.url,alt:e.name,fill:!0,className:"object-cover rounded-lg"})})}),(0,t.jsx)(d.pj,{children:e.name}),(0,t.jsx)(d.pj,{children:e.shop_name}),(0,t.jsx)(d.pj,{children:e.image_count}),(0,t.jsx)(d.pj,{children:new Date(e.created_at).toLocaleString()}),(0,t.jsx)(d.pj,{className:"text-right",children:(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)(o.z,{variant:"outline",size:"icon",onClick:()=>_(e),children:(0,t.jsx)(E.Z,{className:"h-4 w-4"})}),(0,t.jsx)(o.z,{variant:"outline",size:"icon",onClick:()=>handleEdit(e),children:(0,t.jsx)(z.Z,{className:"h-4 w-4"})}),(0,t.jsx)(o.z,{variant:"outline",size:"icon",onClick:()=>{if(!Array.isArray(e.files)||0===e.files.length){(0,h.Am)({variant:"destructive",description:"没有可下载的文件"});return}e.files.forEach((e,a)=>{let s=document.createElement("a");s.href=e.url,s.download=e.name,document.body.appendChild(s),setTimeout(()=>{s.click(),document.body.removeChild(s)},500*a)}),(0,h.Am)({description:"开始下载 ".concat(e.files.length," 个文件")})},children:(0,t.jsx)(A.Z,{className:"h-4 w-4"})}),(0,t.jsx)(o.z,{variant:"outline",size:"icon",onClick:()=>{w(e.id),v(!0)},children:(0,t.jsx)(n.Z,{className:"h-4 w-4"})})]})})]},e.id)})})]})}),x>0&&(0,t.jsx)("div",{className:"flex justify-center mt-4",children:(0,t.jsx)(u.tl,{children:(0,t.jsxs)(u.ng,{children:[(0,t.jsx)(u.nt,{children:(0,t.jsxs)(o.z,{variant:"outline",onClick:e=>{e.preventDefault(),m>1&&handlePageChange(m-1)},disabled:1===m,className:"gap-1",children:[(0,t.jsx)(P.Z,{className:"h-4 w-4"}),"上一页"]})}),Array.from({length:Math.max(1,Z)},(e,a)=>a+1).map(e=>(0,t.jsx)(u.nt,{children:(0,t.jsx)(u.kN,{href:"#",onClick:a=>{a.preventDefault(),handlePageChange(e)},isActive:e===m,children:e})},e)),(0,t.jsx)(u.nt,{children:(0,t.jsxs)(o.z,{variant:"outline",onClick:e=>{e.preventDefault(),m<Z&&handlePageChange(m+1)},disabled:m>=Z,className:"gap-1",children:["下一页",(0,t.jsx)(F.Z,{className:"h-4 w-4"})]})})]})})}),(0,t.jsx)(p.Q,{open:g,onOpenChange:v,title:"删除壁纸",description:"确定要删除这个壁纸吗？此操作不可恢复。",onConfirm:()=>y&&handleDelete()}),(0,t.jsx)(UploadWallpaperModal,{open:N,onOpenChange:S,mode:"edit",initialData:C||void 0,onSuccess:()=>{S(!1),k(null),fetchWallpapers()}}),(0,t.jsx)(O.e,{images:I,initialIndex:R,open:W,onOpenChange:D})]})}var U=s(34522);let L=U.fC,I=l.forwardRef((e,a)=>{let{className:s,...l}=e;return(0,t.jsx)(U.aV,{ref:a,className:(0,v.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...l})});I.displayName=U.aV.displayName;let T=l.forwardRef((e,a)=>{let{className:s,...l}=e;return(0,t.jsx)(U.xz,{ref:a,className:(0,v.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...l})});T.displayName=U.xz.displayName;let W=l.forwardRef((e,a)=>{let{className:s,...l}=e;return(0,t.jsx)(U.VY,{ref:a,className:(0,v.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...l})});function WallpapersPage(){let[e,a]=(0,l.useState)(!1),[s,n]=(0,l.useState)(0),[i,c]=(0,l.useState)(""),[d,u]=(0,l.useState)("all"),[p,m]=(0,l.useState)([]),{toast:x}=(0,h.pm)();(0,l.useEffect)(()=>{fetchShops()},[]),(0,l.useEffect)(()=>{let e=setTimeout(()=>{n(e=>e+1)},300);return()=>clearTimeout(e)},[i]);let fetchShops=async()=>{try{let e=await fetch("/api/shops"),a=await e.json();if(0===a.code)m(a.data);else throw Error(a.message||"获取店铺列表失败")}catch(e){x({variant:"destructive",description:"获取店铺列表失败"})}},j=(0,l.useCallback)(()=>{n(e=>e+1)},[]);return(0,t.jsx)(r.AdminLayout,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,t.jsx)(f.I,{placeholder:"搜索壁纸...",value:i,onChange:e=>c(e.target.value),className:"max-w-sm"}),(0,t.jsx)(L,{value:d,onValueChange:e=>{u(e),n(e=>e+1)},className:"flex-1",children:(0,t.jsxs)(I,{children:[(0,t.jsx)(T,{value:"all",children:"全部"}),p.map(e=>(0,t.jsx)(T,{value:String(e.id),children:e.name},e.id))]})})]}),(0,t.jsx)(o.z,{onClick:()=>a(!0),children:"新增壁纸"})]}),(0,t.jsx)(WallpaperList,{searchQuery:i,shopId:"all"===d?void 0:Number(d)},s),(0,t.jsx)(UploadWallpaperModal,{open:e,onOpenChange:a,onSuccess:j})]})})}W.displayName=U.VY.displayName},17410:function(e,a,s){"use strict";s.d(a,{e:function(){return ImagePreviewModal}});var t=s(26705),l=s(20955),r=s(62031),n=s(82549),i=s(81291),c=s(17158),o=s(23611),d=s(17123);function ImagePreviewModal(e){var a;let{images:s,initialIndex:h=0,open:u,onOpenChange:p}=e,[m,f]=(0,l.useState)(h);(0,l.useEffect)(()=>{m>=s.length&&f(0)},[m,s.length]),(0,l.useEffect)(()=>{f(h)},[h]);let x=s[m],j=null==x?void 0:null===(a=x.type)||void 0===a?void 0:a.startsWith("video/"),g=(0,l.useCallback)(()=>{f(e=>0===e?s.length-1:e-1)},[s.length]),v=(0,l.useCallback)(()=>{f(e=>e===s.length-1?0:e+1)},[s.length]),y=(0,l.useCallback)(e=>{"ArrowLeft"===e.key?g():"ArrowRight"===e.key?v():"Escape"===e.key&&p(!1)},[g,v,p]);return((0,l.useEffect)(()=>{if(u)return window.addEventListener("keydown",y),()=>window.removeEventListener("keydown",y)},[u,y]),s.length&&x)?(0,t.jsx)(r.Vq,{open:u,onOpenChange:p,children:(0,t.jsx)(r.cZ,{className:"max-w-full h-[90vh] p-0 border-none bg-black/90",children:(0,t.jsxs)("div",{className:"relative w-full h-full flex items-center justify-center",children:[(0,t.jsx)(o.z,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 z-50 text-white hover:bg-white/20",onClick:()=>p(!1),children:(0,t.jsx)(n.Z,{className:"h-6 w-6"})}),s.length>1&&(0,t.jsx)(o.z,{variant:"ghost",size:"icon",className:"absolute left-4 z-50 text-white hover:bg-white/20",onClick:g,children:(0,t.jsx)(i.Z,{className:"h-8 w-8"})}),(0,t.jsx)("div",{className:"w-auto h-full flex items-center justify-center p-4",children:(0,t.jsx)("div",{className:"relative h-[80vh]",style:{aspectRatio:"9/16",maxHeight:"80vh"},children:j?(0,t.jsx)(d.F,{src:x.url,className:"h-full w-full object-contain"}):(0,t.jsx)("img",{src:x.url,alt:"",className:"h-full w-full object-contain"})})}),s.length>1&&(0,t.jsx)(o.z,{variant:"ghost",size:"icon",className:"absolute right-4 z-50 text-white hover:bg-white/20",onClick:v,children:(0,t.jsx)(c.Z,{className:"h-8 w-8"})}),s.length>1&&(0,t.jsxs)("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black/50 px-3 py-1 rounded-full",children:[m+1," / ",s.length]})]})})}):null}},17123:function(e,a,s){"use strict";s.d(a,{F:function(){return VideoPreview}});var t=s(26705),l=s(20955),r=s(99848);function VideoPreview(e){let{src:a,className:s,onPlay:n}=e,i=(0,l.useRef)(null),[c,o]=(0,l.useState)(!0),[d,h]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{let e=i.current;if(!e)return;let handleLoadedData=()=>{e.currentTime=.1,h(!0)};return e.addEventListener("loadeddata",handleLoadedData),()=>{e.removeEventListener("loadeddata",handleLoadedData)}},[a]),(0,t.jsxs)("div",{className:"relative w-full h-full",children:[(0,t.jsx)("video",{ref:i,src:a,className:"".concat(s," rounded-lg"),controls:!c}),c&&(0,t.jsx)("button",{onClick:()=>{if(c&&d){var e;null===(e=i.current)||void 0===e||e.play(),o(!1),null==n||n()}},className:"absolute inset-0 flex items-center justify-center bg-black/30 transition-opacity opacity-0 group-hover:opacity-100",children:(0,t.jsx)(r.Z,{className:"w-12 h-12 text-white"})})]})}}},function(e){e.O(0,[371,899,705,691,839,293,536,362,121,290,744],function(){return e(e.s=69894)}),_N_E=e.O()}]);